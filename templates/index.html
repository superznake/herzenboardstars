{% extends "base.html" %}

{% block content %}
<h1>{{ award_config.name }}</h1>

{% if award_config.description %}
    <p>{{ award_config.description }}</p>
{% endif %}

{% if main_categories %}
    <h2>Основные категории</h2>

    <div id="categoriesCarousel" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-inner">

        {% for category in main_categories %}
          <div class="carousel-item {% if forloop.first %}active{% endif %}">
            <div class="card p-3 shadow-sm h-100">
              <h4>{{ category.name }}</h4>

              {% if category.description %}
                <p class="text-muted">{{ category.description }}</p>
              {% endif %}

              {% if current_stage == 'suggest_nominee' %}
                <a href="{% url 'suggest_nominee' category.id %}" class="btn btn-primary mt-2">
                    Предложить номинанта
                </a>
              {% elif current_stage == 'voting' %}
                <a href="{% url 'vote' category.id %}" class="btn btn-primary mt-2">
                    Голосовать
                </a>
              {% endif %}
            </div>
          </div>
        {% endfor %}

      </div>

      <!-- Навигация карусели -->
      <button class="carousel-control-prev" type="button" data-bs-target="#categoriesCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Предыдущая</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#categoriesCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Следующая</span>
      </button>

    </div>
{% endif %}

<p>Текущий этап премии: <strong>{{ award_config.get_current_stage_display }}</strong></p>

{% if current_stage != 'finished' and current_stage != 'results' %}
    {% if not request.user.is_authenticated %}
        <a href="{% url 'login' %}?next={% url 'index' %}" class="btn btn-primary btn-lg mt-3">Голосовать</a>
    {% else %}
        <a href="{% if current_stage == 'suggest_cat' %}{% url 'suggest_category' %}
                  {% elif current_stage == 'suggest_nominee' or current_stage == 'voting' %}{% url 'categories_list' %}{% endif %}"
           class="btn btn-primary btn-lg mt-3">Голосовать</a>
    {% endif %}
{% elif current_stage == 'finished' %}
    <p class="mt-3">Текущий этап завершён. Ожидайте подсчёта голосов.</p>
{% elif current_stage == 'results' %}
    <a href="{% url 'results_public' %}" class="btn btn-success btn-lg mt-3">Посмотреть результаты</a>
{% endif %}
{% endblock %}
